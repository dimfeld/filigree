CREATE TABLE {{table}} (
  {% for field in fields -%}
    {{ field.sql_name }} {{ field.sql_type }}
    {%- if field.unique %} unique {% endif -%}
    {%- if not field.nullable %} not null {% endif -%}
    {%- if field.default != '' %} default {{ field.default }} {% endif -%}
    {%- if field.extra_sql_modifiers != '' %} {{ field.extra_sql_modifiers }} {% endif %}
    ,
  {%- endfor %}
);

{% for field in fields | filter(attribute="indexed", value=true) %}
  CREATE INDEX {{table}}_{{field.sql_name}} ON {{table}} ({{field.sql_name}});
{% endfor %}

{% for i in indexes %}
{{ i }}
{%- if not i is ending_with(';') %};{%- endif -%}
{% endfor %}
